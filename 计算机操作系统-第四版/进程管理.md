# 进程管理

## 数据结构

每个进程或者每个资源都有一个数据结构`（进程信息表）`，内含指针，它们会形成队列结构方便调用和管理。

![image-20201028142259347](进程管理.assets/image-20201028142259347.png)

进程表被称为PCB。

`PCB进程控制块`的作用是使得一个在多道程序环境下不能独立运行的程序称为一个能独立运行的基本单位。

作用：

* 作为独立运行的基本单位的标志。
* 能实现间断性运行方式。
* 提供进程管理所需要的信息。
* 提供进程调度所需要的信息。
* 实现与其他进程的同步和通信。

包含信息：

* 进程标识符
* 处理机状态 --- 就是寄存器那些资源信息，方便被中断后恢复执行。
* 进程调度信息：进程状态，进程优先级等。。。
* 进程控制信息：
  * 程序和数据地址
  * 进程同步和通信机制（消息队列指针，信号量）
  * 资源清单
  * 链接指针，PCB队列里面的下一个进程的PCB的首地址

PCB的组织方式：

![image-20201028143449470](进程管理.assets/image-20201028143449470.png)

线性方式就很简单了。

* 链接方式：相同状态的进程PCB链接成一个队列
* 索引方式：操作系统根据进程状态不一样，建立索引表，把索引表里面在内存的首地址记录在内存的一些专用单元里面。

![image-20201028143816562](进程管理.assets/image-20201028143816562.png)

## 进程控制

操作系统核心功能：

支撑功能：

* 中断处理
* 时钟管理：比如在时间片用完的时候，时钟管理会产生相关的中断信号等等。
* 原语操作：内核中存在很多的原语（因为有些操作必须要么全做，要么不做，不能中断）。

资源管理功能：

* 进程管理
* 存储器管理
* 设备管理

进程的层次结构：

Linux：

* 子进程继承父进程的所有资源，但是子进程销毁的时候必须归还资源，销毁父进程时也必须销毁子进程，要不会产生僵尸进程。

Windows：

* windows不存在等级关系，每个进程都有一个句柄进行标识，等级相同，同时句柄可以用来控制进程且可以进行传递。

进程 创建：

* 申请PCB，为进程分配标识符
* 为新进程分配资源
* 初始化进程控制块。

进程终止：

* 正常终止
* 异常终止
* 外界干预

进程阻塞（block原句），进程唤醒（wakeup原句），进程挂起（suspend原句），进程激活（active原句）。

我觉得阻塞和挂起的最大差别就是挂起的话会终止进程，保存相关信息，方便将来激活，而阻塞只是简单的进程停止，其对资源的控制和信息都在利用之中。

# 进程同步

> 其主要目的在于并发执行的程序可以共享系统资源，多个进程为了完成一个任务可以很好的相互合作。

相互制约：

* 间接相互制约：对一些资源入IO等的争夺引起相互制约。
* 直接相互制约：进程的结果相互影响。

临界资源：进程间必须互斥方式访问。

临界区：代码里面访问临界资源的那段。

## 硬件同步

1. 关中断，这就是在硬件条件上关闭中断，使得在进入临界区操作期间计算机不响应中断。
2. 利用Test-and-Set指令

~~~c
boolean TS(boolean *lock){
 Boolean old;
 old = *lock;
 *lock = TRUE;
 return old;
}
~~~

